var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,o=(t,a,n)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[a]=n,c=(e,t)=>{for(var a in t||(t={}))r.call(t,a)&&o(e,a,t[a]);if(n)for(var a of n(t))s.call(t,a)&&o(e,a,t[a]);return e},l=(e,n)=>t(e,a(n)),i=(e,t,a)=>(o(e,"symbol"!=typeof t?t+"":t,a),a);import{R as m,B as p,A as u,M as d,c as h,L as E,a as _,b as f,D as g,T as v,r as b,m as y,o as w,d as S,e as P,f as k,g as O,h as x,i as C,j as I,k as D,l as N,C as j,n as L,S as R,p as A,q as T}from"./vendor.7503c1f8.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var M="_nav_vwjg8_1";const z=()=>m.createElement(p,{className:M},m.createElement(u,null));var Y="_menu_15lln_1";const F=({className:e})=>m.createElement(d,{className:h([e,Y])},m.createElement(E,{to:"/transform"},m.createElement(_,null,m.createElement(f,null,m.createElement(g,null)),m.createElement(v,null,"转写服务"))));var X="_footer_1y878_1";const $=()=>m.createElement(p,{className:X},m.createElement(v,{color:"textPrimary"},"@tangji 2021-present")),J="https://xunfei-audio.vercel.app";var K="_content_6b8nb_1",U="_contetn-box_6b8nb_9",B="_content-box__boder_6b8nb_15",Z="_content-box__boder--enter_6b8nb_23",q="_content-bo__boder--leave_6b8nb_26";const H=({children:e})=>{const[t,a]=b.exports.useState(!1);return m.createElement(p,{onMouseEnter:()=>{a(!0)},onMouseLeave:()=>{a(!1)},className:h(B,t?Z:q)},e)};const G={config:new class{constructor(){i(this,"APP_ID","41ac2892"),i(this,"SECRET_KEY","476dbac45bca3f32bba334f702e3bc4f"),i(this,"FILE_PIECE_SIZE",1048576),y(this)}changeAppId(e){this.APP_ID=e}changeSecretkey(e){this.SECRET_KEY=e}changeFilePieceSize(e){this.FILE_PIECE_SIZE=e}},preview:new class{constructor(){i(this,"isOpen",!1),i(this,"previewData",""),y(this)}get previewDataJson(){return this.previewData?JSON.parse(this.previewData):[]}changeOpen(e){this.isOpen=e}changePreviewData(e){this.previewData=e}}},Q=b.exports.createContext(G),V=()=>[b.exports.useContext(Q)],W=e=>m.createElement(Q.Provider,{value:e.store},e.children),ee={mouseX:null,mouseY:null},te=e=>m.createElement(m.Fragment,null,e.data.map(((e,t)=>m.createElement("div",{key:t},e.onebest)))),ae=w((()=>{const[e]=V(),[t,a]=b.exports.useState(ee),n=()=>{a(ee)};return m.createElement(S,{open:e.preview.isOpen,onClose:()=>e.preview.changeOpen(!1),scroll:"paper"},m.createElement(P,null,"转写文档（右键操作）"),m.createElement(k,{dividers:!0},m.createElement(O,{onContextMenu:e=>{e.preventDefault(),a({mouseX:e.clientX-2,mouseY:e.clientY-4})}},m.createElement(te,{data:e.preview.previewDataJson})),m.createElement(x,{keepMounted:!0,open:null!==t.mouseX,onClose:n,anchorReference:"anchorPosition",anchorPosition:null!==t.mouseX&&null!==t.mouseY?{top:t.mouseY,left:t.mouseX}:void 0},m.createElement(_,{onClick:n},"复制"),m.createElement(_,{onClick:n},"打印"),m.createElement(_,{onClick:n},"高亮"),m.createElement(_,{onClick:n},"分享"))),m.createElement(C,{color:"primary"},"编辑"))}));class ne{constructor(e=""){this.__ch=e,this.__ch="aaaaaaaaa`"}getNextSliceId(){let e=this.__ch,t=e.length-1;for(;t>=0;){let a=e[t];if("z"!==a){e=e.slice(0,t)+String.fromCharCode(a.charCodeAt(0)+1)+e.slice(t+1);break}e=e.slice(0,t)+"a"+e.slice(t+1),t--}return this.__ch=e,this.__ch}}const re=()=>{const[e,t]=b.exports.useState(null),[a,n]=b.exports.useState(null),[r,s]=b.exports.useState(!1),[o]=V(),i=(e=>{const[t,a]=b.exports.useState({current:!1}),n=b.exports.useCallback((()=>{a({current:!0})}),[t]);return b.exports.useEffect((()=>{t.current&&a({current:!1})}),[t]),b.exports.useEffect((()=>{t.current&&e()})),n})((async()=>{const e=Array.from(a),{APP_ID:t,SECRET_KEY:n,FILE_PIECE_SIZE:r}=o.config,i=e=>{let a=j.MD5(t+e).toString(),r=j.HmacSHA1(a,n);return j.enc.Base64.stringify(r)};for(let p=0;p<e.length;p++){const n=Math.floor(Date.now()/1e3),u=i(n),d=new ne,h=()=>new Promise((async(e,s)=>{const o=await(i={method:"POST",mode:"cors",body:new URLSearchParams({app_id:t,signa:u,ts:String(n),file_len:String(a[p].size),file_name:a[p].name,slice_num:String(Math.ceil(a[p].size/r))})},fetch(`${J}/api/prepare`,i).then((e=>e.json())));var i;0===o.ok?e(o):s(l(c({},o),{stack:"prepare"}))})),E=a=>new Promise((async(s,o)=>{let m=0;const u=async()=>{const s=e[p].size<r?e[p].size:r,o=m+s,c=new FormData;c.append("app_id",t),c.append("ts",String(n)),c.append("signa",i(n)),c.append("task_id",a),c.append("slice_id",d.getNextSliceId()),c.append("content",e[p].slice(m,o<e[p].size?o:e[p].size));let l=await(h={method:"POST",mode:"cors",body:c},fetch(`${J}/api/upload`,h).then((e=>e.json())));var h;return m=o,o>r?l:await u()},h=await u();0===h.ok?s(h):o(l(c({},h),{stack:"upload"}))})),_=e=>new Promise((async(a,r)=>{const s=await(o={method:"POST",mode:"cors",body:new URLSearchParams({app_id:t,signa:u,ts:String(n),task_id:e})},fetch(`${J}/api/merge`,o).then((e=>e.json())));var o;0===s.ok?a(s):r(l(c({},s),{stack:"merge"}))})),f=e=>new Promise((async(a,r)=>{const s=setInterval((async()=>{var o;const i=await(m={method:"POST",mode:"cors",body:new URLSearchParams({app_id:t,signa:u,ts:String(n),task_id:e})},fetch(`${J}/api/getProgress`,m).then((e=>e.json())));var m;0===i.ok?9===(null==(o=JSON.parse(i.data))?void 0:o.status)&&(a(i),clearInterval(s)):(clearInterval(s),r(l(c({},i),{stack:"getProgress"})))}),5e3)})),g=e=>new Promise((async(a,r)=>{const s=await(o={method:"POST",mode:"cors",body:new URLSearchParams({app_id:t,signa:u,ts:String(n),task_id:e})},fetch(`${J}/api/getResult`,o).then((e=>e.json())));var o;0===s.ok?a(s):r(l(c({},s),{stack:"getResult"}))}));try{const e=await h();await E(e.data),await _(e.data),await f(e.data);const t=await g(e.data);o.preview.changePreviewData(t.data)}catch(m){console.error(m)}s(!1)}})),u=async()=>{const e=document.createElement("input");e.type="file",e.accept="audio/*",e.multiple=!0,e.click(),e.onchange=function(e){s(!0),t((e=>null===e?[this.files]:[...e,this.files])),n(this.files),i()}};return m.createElement(p,{className:h(K)},m.createElement(p,{className:h(U)},m.createElement(H,null,m.createElement(C,{disabled:!0},"拖拽上传")),m.createElement(C,{style:{marginTop:20},variant:"contained",color:"primary",onClick:()=>u(),disabled:r},"上传文件")),m.createElement(I,null,e&&e.map((e=>Array.from(e).map(((e,t)=>m.createElement(D,{key:t},m.createElement(p,null,e.name),m.createElement(N,{variant:"determinate",value:100,style:{width:110}}),m.createElement(C,{variant:"contained",onClick:()=>{o.preview.changeOpen(!0)}},"预览"))))))),m.createElement(ae,null))};var se="_app_1hbrd_1",oe="_app-left_1hbrd_7",ce="_app-right_1hbrd_19";const le=()=>m.createElement(L,null,m.createElement("div",{className:se},m.createElement(F,{className:oe}),m.createElement("div",{className:ce},m.createElement(z,null),m.createElement(R,null,m.createElement(A,{path:"/transform"},m.createElement(re,null))),m.createElement($,null))));document.oncontextmenu=e=>{e.preventDefault()},T.render(m.createElement(W,{store:G},m.createElement(le,null)),document.getElementById("root"));
